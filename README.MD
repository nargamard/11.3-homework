# Домашнее задание к занятию "11.03 Микросервисы: подходы"

### Задача 1: Обеспечить разработку
```
Предложите решение для обеспечения процесса разработки: хранение
 исходного кода, непрерывная интеграция и непрерывная поставка. 
 Решение может состоять из одного или нескольких программных 
 продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

Облачная система;
Система контроля версий Git;
Репозиторий на каждый сервис;
Запуск сборки по событию из системы контроля версий;
Запуск сборки по кнопке с указанием параметров;
Возможность привязать настройки к каждой сборке;
Возможность создания шаблонов для различных конфигураций сборок;
Возможность безопасного хранения секретных данных: пароли,
 ключи доступа;
Несколько конфигураций для сборки из одного репозитория;
Кастомные шаги при сборке;
Собственные докер образы для сборки проектов;
Возможность развернуть агентов сборки на собственных серверах;
Возможность параллельного запуска нескольких сборок;
Возможность параллельного запуска тестов;
Обоснуйте свой выбор.
```

Ответ:

Для обеспечения процесса непрерывной сбоки и разработки предлагаю использовать Jenkins, а код хранить в Github, посколько использование этих продуктов бесплатно, требованиям удовлетворяют.
Либо использовать GitLab, поскольку он универсален, сам может хранить код. Зависит от бюджета и размера проекта(команды). В бесплатной версии GitLab ограничения весьма сильные, к примеру, 400 CI/CD минут в месяц; недоступно большое количество функций. Окончательное решение при прочих равных за командой, в использовании какого продукта имеется больший опыт.

---

### Задача 2: Логи

```
Предложите решение для обеспечения сбора и анализа логов сервисов в 
микросервисной архитектуре. Решение может состоять из одного или 
нескольких программных продуктов и должно описывать способы и 
принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

Сбор логов в центральное хранилище со всех хостов обслуживающих 
систему;
Минимальные требования к приложениям, сбор логов из stdout;
Гарантированная доставка логов до центрального хранилища;
Обеспечение поиска и фильтрации по записям логов;
Обеспечение пользовательского интерфейса с возможностью 
предоставления доступа разработчикам для поиска по записям логов;
Возможность дать ссылку на сохраненный поиск по записям логов;
Обоснуйте свой выбор.
```

Ответ:
Всё уже придумано за нас: стек ELK нужен (ElasticSearch, Logstash, Kibana, Fluentd)

Однако, предложу кое-что иное. Тоже ELK, только использовать не filebeat и logstash, а vector, который это всё собой заменяет. И ElasticSearch заменить на ClickHouse. А Кибану в принципе можно научить работать с ClickHouse, хотя задача нетривиальная.
Плюсы такого решения в том, что Clickhouse производительнее Эластика, лучше сжимает данные, но не любит insert и данные должны быть чётко структурированы.
Вот у этих ребят получилось: https://youtu.be/d3GdZTOWGLk
Хотя они там ещё адаптер писали для этого.

Ну или так: вместо filebeat и logstash - Vector, а ElasticSearch и Kibana оставить как есть.

### Задача 3: Мониторинг
```
Предложите решение для обеспечения сбора и анализа состояния хостов и 
сервисов в микросервисной архитектуре. Решение может состоять из 
одного или нескольких программных продуктов и должно описывать 
способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

Сбор метрик со всех хостов, обслуживающих систему;
Сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
Сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, 
Network;
Сбор метрик, специфичных для каждого сервиса;
Пользовательский интерфейс с возможностью делать запросы и 
агрегировать информацию;
Пользовательский интерфейс с возможность настраивать различные панели 
для отслеживания состояния системы;
Обоснуйте свой выбор.
```

Ответ:

Классика: Node_exporter, Prometheus, Grafana. Будет красиво, шустро, и довольно просто.
Никаких Zabbix, о чём и на лекциях говорили, и на практике не столь давно проверил. В общем, Prom+Grafana лучше.

